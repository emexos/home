<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Room-Based Map 40×40</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      display: flex;
      flex-direction: column;
      align-items: center;
      background: #eee;
      color: #111;
      font-family: sans-serif;
      font-size: 18px;
      height: 100vh;
      justify-content: center;
    }
    #btn {
      padding: 16px 32px;
      margin-bottom: 20px;
      cursor: pointer;
      background: #ddd;
      color: #111;
      border: none;
      font-size: 1.75rem;
      border-radius: 50px;
    }
    #maze {
      display: grid;
      grid-template-columns: repeat(40, 16px);
      grid-template-rows:    repeat(40, 16px);
    }
    .cell { width: 16px; height: 16px; background: #111; position: relative; }
    .floor { background: #fff; }
    .label {
      font-family: 'Press Start 2P', monospace;
      font-size: 12px;
      color: #111;
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      pointer-events: none;
    }
  </style>
</head>
<body>
  <button id="btn">Generate Map</button>
  <div id="maze"></div>
  <script>
    const rows = 40, cols = 40;
    let grid = [], rooms = [];
    class Cell { constructor() { this.type = 'wall'; } }

    function initGrid() {
      grid = Array.from({ length: rows }, () => Array.from({ length: cols }, () => new Cell()));
      rooms = [];
    }

    function placeRooms() {
      const occupancy = Array.from({ length: rows }, () => Array(cols).fill(false));
      const roomCount = 6;
      let attempts = 0;
      while (rooms.length < roomCount && attempts < 2000) {
        attempts++;
        const w = Math.floor(Math.random() * 8) + 8;  // 8–15
        const h = Math.floor(Math.random() * 7) + 6;  // 6–12
        const x = Math.floor(Math.random() * (cols - w - 2)) + 1;
        const y = Math.floor(Math.random() * (rows - h - 2)) + 1;
        let overlap = false;
        // check buffer
        for (let yy = y - 1; yy <= y + h; yy++) {
          for (let xx = x - 1; xx <= x + w; xx++) {
            if (yy >= 0 && yy < rows && xx >= 0 && xx < cols && occupancy[yy][xx]) { overlap = true; break; }
          }
          if (overlap) break;
        }
        if (overlap) continue;
        // mark buffer
        for (let yy = y - 1; yy <= y + h; yy++) {
          for (let xx = x - 1; xx <= x + w; xx++) {
            if (yy >= 0 && yy < rows && xx >= 0 && xx < cols) occupancy[yy][xx] = true;
          }
        }
        // carve room
        for (let yy = y; yy < y + h; yy++) {
          for (let xx = x; xx < x + w; xx++) {
            grid[yy][xx].type = 'floor';
          }
        }
        rooms.push({ x, y, w, h });
      }
    }

    function assignLabels() {
      rooms.forEach((r, i) => { if (i === 0) r.label = 'S'; if (i === 1) r.label = 'M'; });
    }

    function connectRooms() {
      const centers = rooms.map(r => ({ x: r.x + Math.floor(r.w / 2), y: r.y + Math.floor(r.h / 2) }));
      for (let i = 1; i < centers.length; i++) {
        carveCorridor(centers[i - 1], centers[i]);
      }
    }

    function carveCorridor(a, b) {
      let x = a.x, y = a.y;
      const horizontalFirst = Math.random() < 0.5;
      if (horizontalFirst) {
        while (x !== b.x) { if (grid[y][x].type !== 'floor') grid[y][x].type = 'floor'; x += x < b.x ? 1 : -1; }
        while (y !== b.y) { if (grid[y][x].type !== 'floor') grid[y][x].type = 'floor'; y += y < b.y ? 1 : -1; }
      } else {
        while (y !== b.y) { if (grid[y][x].type !== 'floor') grid[y][x].type = 'floor'; y += y < b.y ? 1 : -1; }
        while (x !== b.x) { if (grid[y][x].type !== 'floor') grid[y][x].type = 'floor'; x += x < b.x ? 1 : -1; }
      }
      grid[b.y][b.x].type = 'floor';
    }

    function drawMap() {
      const container = document.getElementById('maze'); container.innerHTML = '';
      rooms.forEach(r => { if (r.label) { r.cx = r.x + Math.floor(r.w / 2); r.cy = r.y + Math.floor(r.h / 2); } });
      for (let y = 0; y < rows; y++) {
        for (let x = 0; x < cols; x++) {
          const el = document.createElement('div'); el.className = 'cell';
          if (grid[y][x].type === 'floor') el.classList.add('floor');
          rooms.forEach(r => {
            if (r.label && r.cx === x && r.cy === y) {
              const lbl = document.createElement('div'); lbl.className = 'label'; lbl.textContent = r.label; el.appendChild(lbl);
            }
          });
          container.appendChild(el);
        }
      }
    }

    function generateMap() { initGrid(); placeRooms(); assignLabels(); connectRooms(); drawMap(); }
    document.getElementById('btn').addEventListener('click', generateMap);
    window.addEventListener('DOMContentLoaded', generateMap);
  </script>
</body>
</html>
